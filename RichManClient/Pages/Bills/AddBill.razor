@page "/addbill"
@using ElectronicsShop_service.Dtos
@inject HttpClient Http
@inject NavigationManager NavigationManager

<style>
    /* Add your custom styles here */
    .form-group label {
        color: white;
        font-weight: bold;
    }

    .form-control {
        border-color: blue;
    }

    .btn-primary {
        background-color: blue;
        border-color: white;
        margin-top: 15px;
    }

    /* New custom styles */
    .container {
        background: linear-gradient(to right, white, blue);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    }

    .form-group {
        margin-bottom: 15px;
    }

    /* Center align form and buttons */
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

</style>

<div class="container form-container">

    <h3>Add New Bill</h3>
 
    @if (isBillAdded)
    {
        <div class="alert alert-success mt-3">
            Bill added successfully!
        </div>
    }

    @if (errorMessage != null)
    {
        <div class="alert alert-danger mt-3">
            @errorMessage
        </div>
    }

    <form style="width: 300px;">

        <div class="form-group" style="position:fixed top: 10px; right: 10px;">
            <label for="limitInput">الحد الادنى</label>
            <input type="number" class="form-control" @bind="@newBill.limit" id="limitInput" />
        </div>
        <div class="form-group">
            <label>اسم المشتري</label>
            <input type="text" class="form-control" @bind="@newBill.BuyerName" />
        </div>
        <div class="form-group">
            <label>اسم المحل</label>
            <input type="text" class="form-control" @bind="@newBill.SellerName" />
        </div>
        <div class="form-group">
            <label>تفاصيل اضافية</label>
            <input type="text" class="form-control" @bind="@newBill.Description" />
        </div>

      

        <!-- Allow user to add multiple Cloth objects to the bill -->
        <h4>Clothes:</h4>
        @if (newBill.Suits != null && newBill.Suits.Any())
        {
            @foreach (var cloth in newBill.Suits)
            {
                <div class="form-group">
                    <label>اسم القطعة</label>
                    <input type="text" class="form-control" @bind="@cloth.Name" />
                </div>
                <div class="form-group">
                    <label>الماركة</label>
                    <input type="text" class="form-control" @bind="@cloth.type" />
                </div>
                <div class="form-group">
                    <label>المقاس</label>
                    <input type="number" class="form-control" @bind="@cloth.Size" />
                </div>
                <div class="form-group">
                    <label>اللون</label>
                    <input type="text" class="form-control" @bind="@cloth.Color" />
                </div>
                <div class="form-group">
                    <label>عدد القطع المشترية</label>
                    <input type="number" class="form-control" @bind="@cloth.NumOfPieces" />
                </div>
                <div class="form-group">
                    <label>اسم المحل</label>
                    <input type="text" class="form-control" @bind="@cloth.StoreName" />
                </div>
                <hr />
            }
        }

        <!-- Button to add a new Cloth object to the bill -->

        <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-warning" @onclick="AddNewBill">اضف فاتورة</button>
            <button type="button" class="btn btn-danger" @onclick="AddNewCloth">اضافة قطعة</button>
        </div>
    </form>
</div>


@code {
    private BillDto newBill = new BillDto();
    private bool isBillAdded = false;
    private string errorMessage;
    string Api_Uri = "http://localhost:5000/";

    // Method to add a new Cloth object to the bill
    private void AddNewCloth()
    {
        if (newBill.Suits == null)
        {
            newBill.Suits = new List<Cloth>();
        }
        newBill.Suits.Add(new Cloth());
    }

    private async Task AddNewBill()
    {
        // Here, you can make the API call to add the bill with the clothes
        // You can use the 'newBill' object to send the data to the API

        try
        {
            var response = await Http.PostAsJsonAsync(Api_Uri + "Bill/Post", newBill);

            if (response.IsSuccessStatusCode)
            {
                isBillAdded = true;
                // Optionally, you can reset the newBill object to clear the form after successful addition.
                newBill = new BillDto();
                errorMessage = null; // Reset any previous error message
            }
            else
            {
                // Handle the error scenario here (display error message, etc.)
                isBillAdded = false;
                errorMessage = "Error occurred while adding the bill."; // You can customize the error message.
            }
        }
        catch (Exception ex)
        {
            // Handle the exception
            // For example, you can display a toast message with the error.
            isBillAdded = false;
            errorMessage = ex.Message; // Store the actual exception message for display.
        }
    }
}
