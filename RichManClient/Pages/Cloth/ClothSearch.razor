@page "/search"

@using System.Net.Http.Json
@using System.Text.Json
@using System.Text.Json.Serialization
@using Microsoft.AspNetCore.Components
@using System.Text;
@inject HttpClient Http

<PageTitle>Search</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <h3 class="text-center mb-4" style="color: red;">Search Cloth</h3>
            <form>
                <div class="form-group">
                    <label for="nameInput" class="form-label">Name</label>
                    <input type="text" class="form-control" id="nameInput" @bind="searchCriteria.Name" />
                </div>
                <div class="form-group">
                    <label for="sizeInput" class="form-label">Size</label>
                    <input type="number" class="form-control" id="sizeInput" @bind="searchCriteria.Size" />
                </div>
                <div class="form-group">
                    <label for="colorInput" class="form-label">Color</label>
                    <input type="text" class="form-control" id="colorInput" @bind="searchCriteria.Color" />
                </div>
                <div class="form-group">
                    <label for="makeInput" class="form-label">Make</label>
                    <input type="text" class="form-control" id="makeInput" @bind="searchCriteria.Make" />
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary btn-search" @onclick="Search">Search</button>
                </div>
            </form>
        </div>
    </div>

    <div class="row mt-5 justify-content-center">
        <div class="col-md-8">
            @if (cloths == null)
            {
                <p class="text-center"><em>Loading...</em></p>
            }
            else if (cloths.Count == 0)
            {
                <p class="text-center" style="color: red;">No matching products found.</p>
            }
            else
            {
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th style="color: red;">Name</th>
                            <th style="color: red;">Color</th>
                            <th style="color: red;">Size</th>
                            <th style="color: red;">Make</th>
                            <th style="color: red;">NumOfPieces</th>
                            <th style="color: red;">StoreName</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var cloth in cloths)
                        {
                            @if (cloth.BillId == null)
                            {

                                <tr>
                                    <td>@cloth.Name</td>
                                    <td>@cloth.Color</td>
                                    <td>@cloth.Size</td>
                                    <td>@cloth.type</td>
                                    <td>@cloth.NumOfPieces</td>
                                    <td>@cloth.StoreName</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>

<style>
    /* Custom CSS for styling */
    .btn-search {
        margin-top: 20px;
        background-color: red;
        border-color: black;
    }

    /* Adjust the form inputs' styles */
    .form-control {
        border-color: black;
        border-width: 2px;
    }

    /* Set a custom width for the form */
    .col-md-6 {
        max-width: 400px;
    }

    /* Add some space between the table and the form */
    .mt-5 {
        margin-top: 30px;
    }
</style>
@code {
    private ClothSearchDto searchCriteria = new ClothSearchDto();
    private List<Cloth> cloths;
    string Api_Uri = "http://localhost:5000/";
    private async Task Search()
    {
        using var httpClient = new HttpClient();

        // Serialize the searchCriteria object into JSON
        var json = JsonSerializer.Serialize(searchCriteria);

        // Create the HttpContent from the JSON string
        var content = new StringContent(json, Encoding.UTF8, "application/json");

        // Make the POST request with the JSON content in the request body
        var response = await httpClient.PostAsync(Api_Uri + "Cloth/Search", content);

        if (response.IsSuccessStatusCode)
        {
            // Deserialize the response content into a list of Cloth objects
            cloths = await response.Content.ReadFromJsonAsync<List<Cloth>>();
        }
        else
        {
            // Handle the error scenario here
        }
    }
}

@code {
    public class Cloth
    {
        public string? Name { get; set; }
        public string? Color { get; set; }
        public int Size { get; set; }
        public string? type { get; set; }
        public Guid? BillId { get; set; }
        public int? NumOfPieces { get; set; }
        public string? StoreName { get; set; }
    }

    public class ClothSearchDto
    {
        public string? Name { get; set; }
        public int? Size { get; set; }
        public string? Color { get; set; }
        public string? Make { get; set; }
    }
}
